"""Companion visualizer for the cve-volume-top5 prompt.

Parses the markdown table from LLM output and renders a bar chart
showing CVE IDs vs affected device counts.
"""

import streamlit as st


def visualize(result: str):
    """Parse the CVE table from LLM output and render a bar chart."""
    rows = []
    for line in result.split("\n"):
        line = line.strip()
        if not line.startswith("|") or "---" in line or "Rank" in line:
            continue
        parts = [p.strip() for p in line.split("|")]
        # Expected columns: empty | Rank | CVE ID | Severity | Count | Description | empty
        if len(parts) < 6:
            continue
        cve_id = parts[2]
        try:
            count = int(parts[4])
            rows.append({"CVE": cve_id, "Affected Devices": count})
        except (ValueError, IndexError):
            continue

    if not rows:
        return

    st.subheader("CVE Volume Chart")
    chart_data = {r["CVE"]: r["Affected Devices"] for r in rows}
    st.bar_chart(chart_data)
